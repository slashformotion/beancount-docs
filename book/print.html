<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>TESTINT AI Beancount 3 Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-5b36dd8e.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-ee4a1bf9.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">TESTINT AI Beancount 3 Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="introduction-to-beancount-3"><a class="header" href="#introduction-to-beancount-3">Introduction to Beancount 3</a></h1>
<blockquote>
<p><strong>Experimental Documentation</strong>
This repository is an experiment to verify if Artificial Intelligence can create high-quality technical documentation. The content you see here was generated by an AI agent.</p>
</blockquote>
<p>Welcome to the Beancount 3 documentation.</p>
<p><strong>Beancount</strong> is a double-entry bookkeeping system that runs on your computer. Unlike traditional accounting software (like Quicken, YNAB, or GnuCash) that stores data in complex databases or proprietary file formats, Beancount defines a simple language to describe financial transactions in <strong>plain text files</strong>.</p>
<p>You use your favorite text editor to write down what happened with your money, and Beancount provides the tools to read those files, verify that the math works out, and generate financial reports.</p>
<h2 id="the-philosophy-plain-text-accounting"><a class="header" href="#the-philosophy-plain-text-accounting">The Philosophy: Plain Text Accounting</a></h2>
<p>Beancount belongs to the family of <strong>Plain Text Accounting</strong> (PTA) tools. This approach offers several unique advantages:</p>
<ul>
<li><strong>You own your data</strong>: Your financial history is stored in text files that will be readable 50 years from now, regardless of whether Beancount still exists.</li>
<li><strong>Version Control</strong>: Because it’s text, you can manage your finances with Git. You can track changes, revert mistakes, and sync across devices securely.</li>
<li><strong>Speed and Efficiency</strong>: Entering data is as fast as you can type. There are no slow graphical interfaces or mouse clicks required to enter a coffee purchase.</li>
<li><strong>Programmability</strong>: Since the data is text, it is trivial to write scripts to manipulate it, generate custom charts, or import data from your bank.</li>
</ul>
<h2 id="why-beancount"><a class="header" href="#why-beancount">Why Beancount?</a></h2>
<p>Among the PTA tools (which includes Ledger and Hledger), Beancount is known for:</p>
<ol>
<li><strong>Strictness</strong>: Beancount enforces rules (like requiring you to declare accounts before using them) that prevent typos and errors from creeping into your history.</li>
<li><strong>Python</strong>: Beancount is written in Python (with a C++ core in v3), making it incredibly extensible for anyone who knows the language.</li>
<li><strong>Inventory Booking</strong>: It has a robust model for tracking investments, handling stock lots, cost basis, and capital gains automatically.</li>
</ol>
<h2 id="how-this-guide-is-organized"><a class="header" href="#how-this-guide-is-organized">How this guide is organized</a></h2>
<p>This documentation follows the <strong>Diátaxis</strong> framework to help you find exactly what you need:</p>
<ul>
<li><strong><a href="#getting-started-with-beancount-3">Tutorials</a></strong>: Learning-oriented lessons. Start here if you are brand new to Beancount. We’ll walk you through your first file step-by-step.</li>
<li><strong><a href="#how-to-record-transactions">How-to Guides</a></strong>: Task-oriented recipes. Go here if you want to know “How do I track a stock trade?” or “How do I handle a shared expense?”.</li>
<li><strong><a href="#beancount-3-syntax-reference">Reference</a></strong>: Information-oriented descriptions. Look here for the technical details of the syntax or CLI commands.</li>
<li><strong><a href="#double-entry-principles">Explanation</a></strong>: Understanding-oriented discussions. Read these to understand the <em>concepts</em> behind double-entry accounting and Beancount’s design decisions.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="getting-started-with-beancount-3"><a class="header" href="#getting-started-with-beancount-3">Getting Started with Beancount 3</a></h1>
<p>This tutorial guides you through creating your first Beancount ledger. You will learn how to set up the file structure, define your accounts, and record your first transactions.</p>
<p>By the end of this tutorial, you will have a working accounting system that can produce a balance sheet.</p>
<h2 id="step-1-installation-check"><a class="header" href="#step-1-installation-check">Step 1: Installation Check</a></h2>
<p>Before we begin, ensure you have Beancount 3 installed in your environment.</p>
<pre><code class="language-bash">python3 -m beancount --version
</code></pre>
<p><em>If this command fails, please refer to the installation instructions for your operating system.</em></p>
<h2 id="step-2-the-options"><a class="header" href="#step-2-the-options">Step 2: The Options</a></h2>
<p>Create a new empty text file named <code>main.beancount</code>. This will be your master ledger.</p>
<p>The first thing every Beancount file needs is some basic configuration. Add these lines to the top of your file:</p>
<pre><code class="language-beancount">option "title" "My Personal Finances"
option "operating_currency" "USD"
</code></pre>
<ul>
<li><code>title</code>: Gives your ledger a name, which appears in reports.</li>
<li><code>operating_currency</code>: Tells Beancount which currency is “yours.” You can have multiple operating currencies (e.g., <code>"USD", "EUR"</code>), but you must have at least one.</li>
</ul>
<h2 id="step-3-defining-accounts"><a class="header" href="#step-3-defining-accounts">Step 3: Defining Accounts</a></h2>
<p>Unlike some other plain text accounting tools, Beancount requires you to <strong>declare</strong> an account before you use it. This strictness helps catch typos (like typing <code>Assets:Chekcing</code> by mistake).</p>
<p>We use the <code>open</code> directive to create accounts. We usually date these back to a time before we started tracking (like 1970 or 2000).</p>
<blockquote>
<p><strong>Tip:</strong> Not sure how to name your accounts? Check out the <a href="#how-to-organize-your-accounts">Organizing Accounts</a> guide.</p>
</blockquote>
<p>Add these lines to your file:</p>
<pre><code class="language-beancount">; Define the equity account for initial balances
2000-01-01 open Equity:Opening-Balances

; Define our main bank account
2000-01-01 open Assets:Checking:Chase

; Define a category for food expenses
2000-01-01 open Expenses:Food:Groceries
</code></pre>
<h2 id="step-4-setting-the-opening-balance"><a class="header" href="#step-4-setting-the-opening-balance">Step 4: Setting the Opening Balance</a></h2>
<p>When you start tracking your finances, you likely already have money in your bank account. We need to record this.</p>
<p>In double-entry accounting, money cannot appear out of thin air. It must come <em>from</em> somewhere. For opening balances, it comes from <code>Equity</code>.</p>
<p>Let’s say you have $1,000 in your account on Jan 1st, 2024. Add this transaction:</p>
<pre><code class="language-beancount">2024-01-01 * "Opening Balance for Checking"
  Assets:Checking:Chase       1000.00 USD
  Equity:Opening-Balances    -1000.00 USD
</code></pre>
<p>Notice that the two numbers sum to zero (+1000 and -1000). This is the core rule: <strong>Every transaction must balance to zero.</strong></p>
<h2 id="step-5-recording-a-purchase"><a class="header" href="#step-5-recording-a-purchase">Step 5: Recording a Purchase</a></h2>
<p>Now, let’s spend some money. On Jan 2nd, you bought groceries for $50.</p>
<pre><code class="language-beancount">2024-01-02 * "Whole Foods" "Weekly groceries"
  Expenses:Food:Groceries       50.00 USD
  Assets:Checking:Chase        -50.00 USD
</code></pre>
<blockquote>
<p><strong>Learn More:</strong> See <a href="#how-to-record-transactions">Recording Transactions</a> for more complex examples like salary and split expenses.</p>
</blockquote>
<ul>
<li>We <strong>increased</strong> our Expenses (Expenses are usually positive).</li>
<li>We <strong>decreased</strong> our Assets (money left the checking account).</li>
</ul>
<h2 id="step-6-verification"><a class="header" href="#step-6-verification">Step 6: Verification</a></h2>
<p>Beancount comes with a powerful tool called <code>bean-check</code>. It reads your file and ensures:</p>
<ol>
<li>All syntax is correct.</li>
<li>All transactions balance to zero.</li>
<li>You haven’t used any undeclared accounts.</li>
<li>Your balance assertions (if any) are correct.</li>
</ol>
<p>Run this in your terminal:</p>
<pre><code class="language-bash">bean-check main.beancount
</code></pre>
<blockquote>
<p><strong>Reference:</strong> For more details on command line tools, see the <a href="#beancount-3-command-line-interface">CLI Reference</a>.</p>
</blockquote>
<p>If the command runs silently (no output), your file is perfect! If there are errors, it will tell you the line number and the problem.</p>
<h2 id="step-7-generating-a-report"><a class="header" href="#step-7-generating-a-report">Step 7: Generating a Report</a></h2>
<p>Now that we have data, let’s see a report. The <code>bean-report</code> tool can generate many views. Let’s look at the <strong>balances</strong>:</p>
<pre><code class="language-bash">bean-report main.beancount balances
</code></pre>
<p>You should see output similar to:</p>
<pre><code class="language-text">Assets:Checking:Chase      950.00 USD
Equity:Opening-Balances  -1000.00 USD
Expenses:Food:Groceries     50.00 USD
</code></pre>
<p>You now have a fully functional double-entry accounting system!</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-to-record-transactions"><a class="header" href="#how-to-record-transactions">How to Record Transactions</a></h1>
<p>Transactions describe the movement of commodities (usually money) between accounts. While simple income and expense transactions are common, real life is often more complex.</p>
<p>This guide covers the standard patterns you will encounter.</p>
<h2 id="the-anatomy-of-a-transaction"><a class="header" href="#the-anatomy-of-a-transaction">The Anatomy of a Transaction</a></h2>
<p>A transaction is a single unit that ensures money is neither created nor destroyed (except through Income/Equity).</p>
<pre><code class="language-beancount">2024-01-10 * "Payee" "Narration / Description"
  Account1     -10.00 USD
  Account2      10.00 USD
</code></pre>
<ul>
<li><strong>Date</strong>: <code>YYYY-MM-DD</code>. Strict requirement.</li>
<li><strong>Flag</strong>: <code>*</code> (cleared/confirmed) or <code>!</code> (pending).</li>
<li><strong>Payee</strong>: (Optional) Who did you trade with?</li>
<li><strong>Narration</strong>: (Optional) What was this for?</li>
<li><strong>Postings</strong>: The lines indented below. You can have as many as you want, as long as they sum to zero.</li>
</ul>
<hr>
<h2 id="1-complex-income-salary-with-deductions"><a class="header" href="#1-complex-income-salary-with-deductions">1. Complex Income (Salary with Deductions)</a></h2>
<p>Real paychecks are rarely just “Income -&gt; Bank”. They include taxes, 401k contributions, and insurance. You record all of these in a single transaction.</p>
<blockquote>
<p><strong>Why is Income negative?</strong>
In Beancount, Income is money flowing <em>from</em> the outside world <em>into</em> your accounts. To make the math balance to zero, Income is recorded as a negative number.
<a href="#why-is-income-negative">Read the full explanation here</a>.</p>
</blockquote>
<pre><code class="language-beancount">2024-01-15 * "Tech Corp" "Payroll #42"
  Assets:Checking:Chase        2500.00 USD  ; Net pay deposited
  Expenses:Taxes:Federal        500.00 USD
  Expenses:Taxes:State          200.00 USD
  Assets:401k:PreTax            300.00 USD  ; Contribution to retirement
  Expenses:Insurance:Health     100.00 USD
  Income:Salary               -3600.00 USD  ; Gross Pay (negative)
</code></pre>
<p><em>Note that the Gross Pay (-3600) balances out all the positive numbers (2500+500+200+300+100).</em></p>
<h2 id="2-shared-expenses-reimbursements"><a class="header" href="#2-shared-expenses-reimbursements">2. Shared Expenses (Reimbursements)</a></h2>
<p>If you pay for lunch for a friend and they pay you back later, you shouldn’t record the full amount as <em>your</em> expense.</p>
<p><strong>Scenario:</strong> You pay $40. $20 is your food, $20 is for Alice.</p>
<pre><code class="language-beancount">2024-02-01 * "Restaurant" "Lunch with Alice"
  Assets:Checking:Chase        -40.00 USD
  Expenses:Food:Dining          20.00 USD
  Assets:Receivable:Alice       20.00 USD
</code></pre>
<p>Later, when Alice pays you back:</p>
<pre><code class="language-beancount">2024-02-05 * "Alice" "Venmo repayment"
  Assets:Checking:Chase         20.00 USD
  Assets:Receivable:Alice      -20.00 USD
</code></pre>
<p><em>Your <code>Assets:Receivable:Alice</code> account is now zero.</em></p>
<h2 id="3-foreign-currency-vacation"><a class="header" href="#3-foreign-currency-vacation">3. Foreign Currency (Vacation)</a></h2>
<p>When you use a card abroad, the bank converts the currency. You should record the actual cost to you (in your home currency) or the exact conversion if you want to track the foreign currency.</p>
<p><strong>Simple approach (Convert at cost):</strong>
You bought a €10 coffee, and your bank charged you $11.20.</p>
<pre><code class="language-beancount">2024-03-10 * "Cafe Paris" "Coffee"
  Expenses:Travel:Food          11.20 USD
  Assets:Checking:Chase        -11.20 USD
</code></pre>
<p><strong>Advanced approach (Tracking rates):</strong>
Explicitly stating the exchange rate using <code>@</code>.</p>
<pre><code class="language-beancount">2024-03-10 * "Cafe Paris" "Coffee"
  Expenses:Travel:Food          10.00 EUR @ 1.12 USD
  Assets:Checking:Chase        -11.20 USD
</code></pre>
<h2 id="4-metadata-tags-and-links"><a class="header" href="#4-metadata-tags-and-links">4. Metadata, Tags, and Links</a></h2>
<p>You can attach extra data to transactions to help with filtering later.</p>
<blockquote>
<p><strong>Deep Dive:</strong> For full syntax details, see the <a href="#the-transaction-block">Syntax Reference</a>.</p>
</blockquote>
<ul>
<li><strong>Tags</strong>: Use <code>#tagname</code> for categories that cross-cut accounts (like <code>#vacation2024</code> or <code>#tax-deductible</code>).</li>
<li><strong>Links</strong>: Use <code>^linkname</code> to group related transactions (like an invoice and its payment).</li>
<li><strong>Metadata</strong>: Key-value pairs for specific details.</li>
</ul>
<pre><code class="language-beancount">2024-04-01 * "Hotel" "Stay in Tokyo" #vacation2024 ^invoice-1234
  booking_id: "XYZ-999"
  Liabilities:CreditCard      -200.00 USD
  Expenses:Travel:Lodging      200.00 USD
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-to-record-trades"><a class="header" href="#how-to-record-trades">How to Record Trades</a></h1>
<p>Tracking investments requires recording the <strong>cost basis</strong> (what you paid) so you can calculate capital gains when you sell.</p>
<h2 id="buying-assets"><a class="header" href="#buying-assets">Buying Assets</a></h2>
<p>When you buy an asset (like a stock), you record the cost per share using curly braces <code>{}</code>.</p>
<blockquote>
<p><strong>Why the curly braces?</strong> Beancount tracks distinct “lots” of inventory. See <a href="#how-inventories-work">How Inventories Work</a> for a deep dive.</p>
</blockquote>
<pre><code class="language-beancount">2024-05-01 * "Buy AAPL"
  Assets:Brokerage:Cash      -1500.00 USD
  Assets:Brokerage:AAPL         10 AAPL {150.00 USD}
</code></pre>
<p><em>Here, we bought 10 shares of AAPL at $150.00 each.</em></p>
<h2 id="selling-assets"><a class="header" href="#selling-assets">Selling Assets</a></h2>
<p>When you sell, you must specify which “lot” you are selling by matching the original cost basis. You also record the selling price using <code>@</code>.</p>
<p>The difference between the <strong>cost</strong> <code>{...}</code> and the <strong>price</strong> <code>@</code> is your Capital Gain (or Loss).</p>
<pre><code class="language-beancount">2024-06-01 * "Sell AAPL"
  Assets:Brokerage:AAPL         -5 AAPL {150.00 USD} @ 160.00 USD
  Assets:Brokerage:Cash        800.00 USD
  Income:CapitalGains          -50.00 USD
</code></pre>
<p><em>We sold 5 shares. Cost: $750 (5 * 150). Proceeds: $800 (5 * 160). Profit: $50.</em></p>
<h2 id="taxable-vs-tax-exempt-accounts"><a class="header" href="#taxable-vs-tax-exempt-accounts">Taxable vs. Tax-Exempt Accounts</a></h2>
<p>The syntax for the trade is the same, but the <strong>Income</strong> account you use for the gains should differ.</p>
<h3 id="1-taxable-account"><a class="header" href="#1-taxable-account">1. Taxable Account</a></h3>
<p>In a standard brokerage account, every sale is a taxable event. You should book gains to an Income account that reflects taxable income.</p>
<pre><code class="language-beancount">2024-06-01 * "Sell Stock in Taxable"
  Assets:Taxable:AAPL           -5 AAPL {150.00 USD} @ 160.00 USD
  Assets:Taxable:Cash          800.00 USD
  Income:Taxable:CapitalGains  -50.00 USD
</code></pre>
<h3 id="2-tax-exempt--tax-advantaged-account-ira-401k"><a class="header" href="#2-tax-exempt--tax-advantaged-account-ira-401k">2. Tax-Exempt / Tax-Advantaged Account (IRA, 401k)</a></h3>
<p>In accounts like an IRA, you don’t pay taxes on individual trades. However, <strong>Beancount still requires the transaction to balance.</strong> You still made a profit, even if the IRS doesn’t care yet.</p>
<p>To handle this, map the gains to an Income account specifically for that tax shelter. This keeps it separate from your taxable income reports.</p>
<pre><code class="language-beancount">2024-06-01 * "Sell Stock in IRA"
  Assets:IRA:AAPL               -5 AAPL {150.00 USD} @ 160.00 USD
  Assets:IRA:Cash              800.00 USD
  Income:IRA:Gains             -50.00 USD
</code></pre>
<p>By separating <code>Income:Taxable:CapitalGains</code> and <code>Income:IRA:Gains</code>, you can easily filter your reports to see only your taxable obligations.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-to-track-stock-vesting-rsus"><a class="header" href="#how-to-track-stock-vesting-rsus">How to Track Stock Vesting (RSUs)</a></h1>
<p>Restricted Stock Units (RSUs) are a common form of compensation. Tracking them requires handling the income event (vesting) and the subsequent capital gains (selling).</p>
<h2 id="1-the-grant"><a class="header" href="#1-the-grant">1. The Grant</a></h2>
<p>When you are granted RSUs, you don’t actually own anything yet. You technically don’t need to record this in your main ledger, but you can track it in a separate “Shadow” account if you wish.</p>
<p><em>Most users skip this step and start at Vesting.</em></p>
<h2 id="2-vesting-the-taxable-event"><a class="header" href="#2-vesting-the-taxable-event">2. Vesting (The Taxable Event)</a></h2>
<p>When shares vest, two things happen:</p>
<ol>
<li>You receive shares (Asset).</li>
<li>You pay taxes (Expense), usually by selling some of those shares immediately (“Sell to Cover”).</li>
<li>You recognize the total value as Income.</li>
</ol>
<p><strong>Example:</strong></p>
<ul>
<li>You vest 10 shares of <code>GOOG</code>.</li>
<li>Market price is $100/share. Total Value: $1000.</li>
<li>Tax rate is 40%. You “sell” 4 shares to pay $400 in taxes.</li>
<li>You keep 6 shares.</li>
</ul>
<pre><code class="language-beancount">2024-05-15 * "Employer" "RSU Vest - 10 shares"
  Income:Employer:RSU          -1000.00 USD  ; Total Grant Value
  Expenses:Taxes:Federal         400.00 USD  ; Taxes paid
  Assets:Brokerage:GOOG            6 GOOG {100.00 USD}
</code></pre>
<ul>
<li><strong>Income</strong>: We record the full gross amount ($1000).</li>
<li><strong>Asset</strong>: We record the 6 shares we actually kept, with a <strong>cost basis</strong> of the market price at that moment (<code>{100.00 USD}</code>).</li>
</ul>
<h2 id="3-selling"><a class="header" href="#3-selling">3. Selling</a></h2>
<p>Later, when you sell the shares, you calculate Capital Gains based on that cost basis.</p>
<p><strong>Scenario:</strong> Price rises to $120. You sell your 6 shares.</p>
<pre><code class="language-beancount">2024-08-01 * "Broker" "Sell RSUs"
  Assets:Brokerage:GOOG           -6 GOOG {100.00 USD} @ 120.00 USD
  Assets:Brokerage:Cash          720.00 USD
  Income:CapitalGains           -120.00 USD
</code></pre>
<ul>
<li><strong>Cost</strong>: $600 (6 * 100).</li>
<li><strong>Proceeds</strong>: $720 (6 * 120).</li>
<li><strong>Gain</strong>: $120.</li>
</ul>
<h2 id="employee-stock-purchase-plan-espp"><a class="header" href="#employee-stock-purchase-plan-espp">Employee Stock Purchase Plan (ESPP)</a></h2>
<p>ESPP is different. You buy shares at a discount.</p>
<p><strong>Example:</strong></p>
<ul>
<li>Market Price: $100.</li>
<li>Discount: 15% (You pay $85).</li>
<li>You buy 10 shares.</li>
</ul>
<pre><code class="language-beancount">2024-06-30 * "Employer" "ESPP Purchase"
  Assets:Brokerage:Cash         -850.00 USD ; You paid $850
  Income:Employer:ESPP-Discount -150.00 USD ; The discount is essentially income
  Assets:Brokerage:GOOG           10 GOOG {100.00 USD} ; Cost basis is Fair Market Value
</code></pre>
<p><em>Note: ESPP tax rules are complex (Qualifying vs Disqualifying dispositions). This method sets the cost basis to the FMV ($100), treating the discount as immediate income. Consult a tax professional for your specific reporting needs.</em></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="managing-shared-expenses"><a class="header" href="#managing-shared-expenses">Managing Shared Expenses</a></h1>
<p>When you share finances with a partner, roommate, or group, you often pay for things on their behalf. Beancount handles this by tracking <strong>Receivables</strong> (money owed to you) and <strong>Payables</strong> (money you owe).</p>
<h2 id="scenario-1-you-pay-they-owe-you"><a class="header" href="#scenario-1-you-pay-they-owe-you">Scenario 1: You pay, they owe you</a></h2>
<p>You pay $100 for dinner. $50 is for you, $50 is for your friend “Alice”.</p>
<pre><code class="language-beancount">2024-06-01 * "Restaurant" "Dinner with Alice"
  Assets:CreditCard:Visa        -100.00 USD
  Expenses:Food:Dining            50.00 USD
  Assets:Receivable:Alice         50.00 USD
</code></pre>
<ul>
<li><strong>Your Expense</strong>: Only $50.</li>
<li><strong>Asset</strong>: You now hold a $50 claim against Alice.</li>
</ul>
<p>When Alice pays you back:</p>
<pre><code class="language-beancount">2024-06-05 * "Alice" "Venmo repayment"
  Assets:Bank:Checking            50.00 USD
  Assets:Receivable:Alice        -50.00 USD
</code></pre>
<p><em>The Receivable account is now zero.</em></p>
<h2 id="scenario-2-they-pay-you-owe-them"><a class="header" href="#scenario-2-they-pay-you-owe-them">Scenario 2: They pay, you owe them</a></h2>
<p>Alice pays $100. Your share is $50.</p>
<pre><code class="language-beancount">2024-06-01 * "Alice" "Paid for dinner"
  Expenses:Food:Dining            50.00 USD
  Liabilities:Payable:Alice      -50.00 USD
</code></pre>
<p>When you pay her back:</p>
<pre><code class="language-beancount">2024-06-05 * "Venmo" "Paying Alice back"
  Liabilities:Payable:Alice       50.00 USD
  Assets:Bank:Checking           -50.00 USD
</code></pre>
<h2 id="scenario-3-netting-out-the-tabs-approach"><a class="header" href="#scenario-3-netting-out-the-tabs-approach">Scenario 3: Netting Out (The “Tabs” approach)</a></h2>
<p>If you live with someone, you might not settle every transaction. You just want to track the running balance.</p>
<p>Use a single account: <code>Assets:Partner</code>.</p>
<ul>
<li>Positive balance: They owe you.</li>
<li>Negative balance: You owe them.</li>
</ul>
<p><strong>You pay electric bill ($100, split 50/50):</strong></p>
<pre><code class="language-beancount">2024-06-01 * "Electric Co"
  Assets:Bank                     -100.00 USD
  Expenses:Utilities                50.00 USD
  Assets:Partner                    50.00 USD
</code></pre>
<p><strong>They pay rent ($2000, split 1000/1000):</strong></p>
<pre><code class="language-beancount">2024-06-01 * "Partner paid rent"
  Expenses:Housing:Rent           1000.00 USD
  Assets:Partner                 -1000.00 USD
</code></pre>
<p><strong>Current Balance of <code>Assets:Partner</code></strong>: <code>-950.00 USD</code>. You owe them $950.
You write them a check for $950 to settle up.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="health-care--insurance"><a class="header" href="#health-care--insurance">Health Care &amp; Insurance</a></h1>
<p>Medical billing is complex. A single doctor’s visit can generate multiple bills, insurance adjustments, and reimbursements over months. Beancount’s <strong>Link</strong> feature (<code>^</code>) is perfect for this.</p>
<h2 id="tracking-claims-the-incident"><a class="header" href="#tracking-claims-the-incident">Tracking Claims (The “Incident”)</a></h2>
<p>Use a unique link identifier for each medical event.</p>
<p><strong>Step 1: The Visit</strong>
You go to the doctor. You pay a $30 copay.</p>
<pre><code class="language-beancount">2024-03-01 * "Dr. Smith" "Checkup" ^claim-2024-03-smith
  Expenses:Medical:Doctor          30.00 USD
  Assets:CreditCard               -30.00 USD
</code></pre>
<p><strong>Step 2: The Bill Arrives</strong>
A month later, you get a bill for the remaining $150 that insurance didn’t cover.</p>
<pre><code class="language-beancount">2024-04-01 * "Dr. Smith" "Remaining balance" ^claim-2024-03-smith
  Expenses:Medical:Doctor         150.00 USD
  Assets:CreditCard              -150.00 USD
</code></pre>
<p><strong>Step 3: Insurance Reimbursement</strong>
Oops, insurance decided to cover $50 of that after all.</p>
<pre><code class="language-beancount">2024-04-15 * "Aetna" "Reimbursement" ^claim-2024-03-smith
  Assets:Bank                      50.00 USD
  Expenses:Medical:Doctor         -50.00 USD
</code></pre>
<p>By clicking the <code>^claim-2024-03-smith</code> link in Fava, you can see the entire history of this specific medical event and calculate the true final cost ($130).</p>
<h2 id="health-savings-accounts-hsa"><a class="header" href="#health-savings-accounts-hsa">Health Savings Accounts (HSA)</a></h2>
<p>HSAs are triple-tax-advantaged accounts. Treat them like any other investment asset.</p>
<p><strong>Contribution (Payroll)</strong></p>
<pre><code class="language-beancount">2024-01-15 * "Paycheck"
  Assets:Bank                    2000.00 USD
  Assets:HSA:Cash                 100.00 USD
  Income:Salary                 -2100.00 USD
</code></pre>
<p><strong>Spending from HSA</strong>
When you use your HSA card, you are spending directly from that asset.</p>
<pre><code class="language-beancount">2024-03-01 * "Pharmacy" "Prescription"
  Expenses:Medical:Meds            15.00 USD
  Assets:HSA:Cash                 -15.00 USD
</code></pre>
<p><strong>Investing HSA</strong>
If you invest your HSA funds, track the commodities just like a brokerage account.</p>
<pre><code class="language-beancount">2024-06-01 * "Buy Fund"
  Assets:HSA:VTSAX             5 VTSAX {100.00 USD}
  Assets:HSA:Cash             -500.00 USD
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="portfolio-returns"><a class="header" href="#portfolio-returns">Portfolio Returns</a></h1>
<p>A common question is: “What is my investment return?” (e.g., “I made 8% this year”).</p>
<p>Beancount <strong>does not</strong> calculate percentage returns (IRR or TWR) natively in the core engine. It focuses on accounting correctness (Cost Basis and Capital Gains). However, you can extract the data needed to calculate this.</p>
<h2 id="the-challenge"><a class="header" href="#the-challenge">The Challenge</a></h2>
<p>To calculate returns, you need to know:</p>
<ol>
<li>The value of the portfolio at the start.</li>
<li>The value at the end.</li>
<li>The exact date and amount of every <strong>cash flow</strong> in and out.</li>
</ol>
<p>Since Beancount tracks all of this, the data is there.</p>
<h2 id="solution-1-fava"><a class="header" href="#solution-1-fava">Solution 1: Fava</a></h2>
<p>Fava has a built-in “Holdings” view that attempts to calculate returns for your assets. This is the easiest way for most users.</p>
<h2 id="solution-2-scripts"><a class="header" href="#solution-2-scripts">Solution 2: Scripts</a></h2>
<p>The standard way to calculate returns in the Beancount ecosystem is to use a script to extract the cash flows and compute the <strong>Internal Rate of Return (IRR)</strong>.</p>
<p>Beancount provides a helper library <code>beancount.plugins.ira_contribs</code> which can help track contributions, but for returns, community scripts are often used.</p>
<h2 id="calculating-simple-gain-profit"><a class="header" href="#calculating-simple-gain-profit">Calculating Simple Gain (Profit)</a></h2>
<p>You can easily see your total profit (Market Value - Cost Basis) in <code>bean-query</code>.</p>
<pre><code class="language-sql">SELECT
  account,
  sum(convert(position, 'USD')) as market_value,
  sum(cost(position)) as cost_basis,
  (sum(convert(position, 'USD')) - sum(cost(position))) as unrealized_gain
WHERE account ~ "Assets:Investments"
GROUP BY account
</code></pre>
<p><em>Note: This query requires that you have updated prices for your commodities.</em></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="short-sales"><a class="header" href="#short-sales">Short Sales</a></h1>
<p>A <strong>Short Sale</strong> is when you sell an asset you don’t own (by borrowing it), hoping to buy it back later at a lower price.</p>
<p>In Beancount terms, this means holding a <strong>negative number of units held at cost</strong>.</p>
<h2 id="the-constraint"><a class="header" href="#the-constraint">The Constraint</a></h2>
<p>By default, Beancount enforces a constraint: you cannot have a negative inventory of lots.</p>
<ul>
<li>If you hold <code>10 GOOG {100 USD}</code>, you can sell at most 10.</li>
<li>If you try to sell 15, you get an error.</li>
</ul>
<h2 id="enabling-short-sales"><a class="header" href="#enabling-short-sales">Enabling Short Sales</a></h2>
<p>To allow short selling, you generally need to relax this constraint or use a dedicated account where the negative balance is expected.</p>
<h3 id="method-1-dedicated-short-account"><a class="header" href="#method-1-dedicated-short-account">Method 1: Dedicated Short Account</a></h3>
<p>Separate your “Long” and “Short” positions.</p>
<pre><code class="language-beancount">2024-06-01 * "Short Sell"
  Assets:Brokerage:Cash          1000.00 USD
  Liabilities:Brokerage:Shorts    -10 GOOG {100.00 USD}
</code></pre>
<p>Here, we use a <strong>Liability</strong> account to track the short position. A negative liability is… well, usually a liability is already negative (credit). Wait.</p>
<p>In Beancount:</p>
<ul>
<li>Assets are Positive.</li>
<li>Liabilities are Negative.</li>
</ul>
<p>If you are Short, you <strong>owe</strong> the stock. It is a Liability.
So <code>Liabilities:Brokerage:Shorts</code> should have a <strong>negative</strong> number of units.</p>
<p><strong>Closing the Short (Covering):</strong>
You buy the stock back.</p>
<pre><code class="language-beancount">2024-07-01 * "Cover Short"
  Liabilities:Brokerage:Shorts     10 GOOG {100.00 USD} @ 90.00 USD
  Assets:Brokerage:Cash          -900.00 USD
  Income:CapitalGains            -100.00 USD
</code></pre>
<ul>
<li>You “buy” 10 units to neutralize the -10 units.</li>
<li>Cost Basis match: <code>{100.00 USD}</code>.</li>
<li>Price paid: <code>$900</code>.</li>
<li>Profit: <code>$100</code>.</li>
</ul>
<h2 id="caveats"><a class="header" href="#caveats">Caveats</a></h2>
<ul>
<li><strong>Dividends</strong>: If you are short, you <em>pay</em> dividends instead of receiving them. This is an Expense.</li>
<li><strong>Interest</strong>: You usually pay margin interest on the borrowed value.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-to-manage-documents"><a class="header" href="#how-to-manage-documents">How to Manage Documents</a></h1>
<p>Beancount allows you to link external files (PDFs, images) to specific transactions. This is invaluable for auditing and keeping track of receipts.</p>
<h2 id="the-document-directive"><a class="header" href="#the-document-directive">The <code>document</code> directive</a></h2>
<p>To link a file to an account (without a specific transaction context), use the <code>document</code> directive.</p>
<pre><code class="language-beancount">2024-03-15 document Liabilities:CreditCard "/path/to/statement_mar2024.pdf"
</code></pre>
<h2 id="linking-to-transactions"><a class="header" href="#linking-to-transactions">Linking to Transactions</a></h2>
<p>Beancount automatically associates documents with transactions if the date and tags match, but the most robust way is to use the <strong>metadata</strong> field <code>statement</code> or simply let <a href="#using-fava-web-ui">Fava</a> handle the discovery based on file location.</p>
<p>However, the standard convention in Beancount 3 is to use the <code>document</code> directive to declare the file exists, and then standard tooling (like <a href="#using-fava-web-ui">Fava</a>) displays it.</p>
<h3 id="organizing-files"><a class="header" href="#organizing-files">Organizing Files</a></h3>
<p>Beancount enforces a specific directory structure for documents if you want automatic discovery:</p>
<pre><code class="language-text">/path/to/documents/
  Liabilities/
    CreditCard/
      2024-03-15.Statement.pdf
</code></pre>
<ol>
<li>Set the <code>documents</code> option in your file:
<pre><code class="language-beancount">option "documents" "/path/to/documents"
</code></pre>
</li>
<li>Beancount will scan this directory.</li>
<li>Fava will automatically show <code>2024-03-15.Statement.pdf</code> next to any transaction involving <code>Liabilities:CreditCard</code> on that date.</li>
</ol>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<ul>
<li><strong>Scans</strong>: Scan all physical receipts immediately.</li>
<li><strong>Naming</strong>: Use <code>YYYY-MM-DD.Description.pdf</code> so they sort naturally in your file explorer.</li>
<li><strong>Privacy</strong>: Remember these files are just on your disk. Beancount doesn’t encrypt them.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-to-fetch-market-prices"><a class="header" href="#how-to-fetch-market-prices">How to Fetch Market Prices</a></h1>
<p>To track the value of your investments (Stocks, ETFs, Crypto) in Beancount, you need to record their market price over time.</p>
<h2 id="the-price-directive"><a class="header" href="#the-price-directive">The <code>price</code> Directive</a></h2>
<p>Manually, you can add prices like this:</p>
<pre><code class="language-beancount">2024-01-01 price AAPL 150.00 USD
2024-01-02 price AAPL 152.00 USD
</code></pre>
<p>But doing this manually is tedious.</p>
<h2 id="using-bean-price"><a class="header" href="#using-bean-price">Using <code>bean-price</code></a></h2>
<p>Beancount comes with a tool called <code>bean-price</code> that fetches prices from the internet.</p>
<h3 id="1-install-requirements"><a class="header" href="#1-install-requirements">1. Install Requirements</a></h3>
<p>You might need to install extra sources:</p>
<pre><code class="language-bash">pip install beancount-beanprice
</code></pre>
<h3 id="2-configure-your-commodities"><a class="header" href="#2-configure-your-commodities">2. Configure Your Commodities</a></h3>
<p>You need to tell <code>bean-price</code> where to look for the price. You do this by adding metadata to your <code>commodity</code> directive.</p>
<blockquote>
<p><strong>Note:</strong> The <code>commodity</code> directive is optional in basic Beancount but required if you want to attach metadata like this. See <a href="#5-commodity">Syntax Reference</a>.</p>
</blockquote>
<pre><code class="language-beancount">1980-01-01 commodity AAPL
  price: "Yahoo/AAPL"
  name: "Apple Inc."

1980-01-01 commodity BTC
  price: "Coinbase/BTC-USD"
</code></pre>
<h3 id="3-run-the-tool"><a class="header" href="#3-run-the-tool">3. Run the Tool</a></h3>
<p>Run <code>bean-price</code> against your ledger file. It will:</p>
<ol>
<li>Find all commodities with a <code>price</code> source.</li>
<li>Find the last date they were updated.</li>
<li>Fetch the current price.</li>
</ol>
<pre><code class="language-bash">bean-price main.beancount
</code></pre>
<h3 id="4-save-the-prices"><a class="header" href="#4-save-the-prices">4. Save the Prices</a></h3>
<p>Usually, you append the output to a separate prices file (e.g., <code>prices.beancount</code>) that you include in your main file.</p>
<p><strong>In <code>main.beancount</code>:</strong></p>
<pre><code class="language-beancount">include "prices.beancount"
</code></pre>
<p><strong>Run command:</strong></p>
<pre><code class="language-bash">bean-price -e USD main.beancount &gt;&gt; prices.beancount
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="query-cookbook"><a class="header" href="#query-cookbook">Query Cookbook</a></h1>
<p><code>bean-query</code> is a powerful command-line tool that lets you extract data from your Beancount file using a SQL-like language called <strong>BQL</strong> (Beancount Query Language).</p>
<p>Unlike standard SQL which queries a database on disk, <code>bean-query</code> loads your text file into memory and runs queries against the internal data structures.</p>
<blockquote>
<p><strong>Note:</strong> For simple text reports (like balances or income statements), see <a href="#how-to-run-reports">Running Reports</a> instead.</p>
</blockquote>
<h2 id="how-to-use-bean-query"><a class="header" href="#how-to-use-bean-query">How to use <code>bean-query</code></a></h2>
<h3 id="1-interactive-mode-shell"><a class="header" href="#1-interactive-mode-shell">1. Interactive Mode (Shell)</a></h3>
<p>If you run the command without a query string, you enter an interactive shell. This is best for exploring data.</p>
<pre><code class="language-bash">$ bean-query main.beancount
Input file: "main.beancount"
Ready with 1000 directives (1500 postings).
beancount&gt; SELECT sum(position) WHERE account ~ "Assets"
...
</code></pre>
<p>Type <code>help</code> inside the shell to see available commands.</p>
<h3 id="2-command-line-mode-scripting"><a class="header" href="#2-command-line-mode-scripting">2. Command Line Mode (Scripting)</a></h3>
<p>You can pass the query directly as a string. This is useful for scripts or quick checks.</p>
<pre><code class="language-bash">bean-query main.beancount "SELECT sum(position) WHERE account ~ 'Assets'"
</code></pre>
<h2 id="core-concepts"><a class="header" href="#core-concepts">Core Concepts</a></h2>
<h3 id="available-columns"><a class="header" href="#available-columns">Available Columns</a></h3>
<p>Every transaction posting has specific columns you can query:</p>
<ul>
<li><code>date</code>: The date of the transaction.</li>
<li><code>account</code>: The account name (e.g., <code>Assets:Bank</code>).</li>
<li><code>narration</code>: The description text.</li>
<li><code>payee</code>: The payee text.</li>
<li><code>position</code>: The amount and currency (e.g., <code>10.00 USD</code>).</li>
<li><code>balance</code>: The cumulative balance after this posting.</li>
<li><code>tags</code>: A set of tags attached to the transaction.</li>
<li><code>links</code>: A set of links attached to the transaction.</li>
</ul>
<h3 id="functions"><a class="header" href="#functions">Functions</a></h3>
<p>BQL supports many functions to manipulate data:</p>
<ul>
<li><code>year(date)</code>, <code>month(date)</code>: Extract date parts.</li>
<li><code>root(account, 2)</code>: Get the parent account (e.g., <code>Assets:Bank</code> from <code>Assets:Bank:Chase</code>).</li>
<li><code>sum(position)</code>: Add up amounts (handles multiple currencies automatically).</li>
<li><code>abs(amount)</code>: Absolute value.</li>
</ul>
<hr>
<h2 id="spending-analysis"><a class="header" href="#spending-analysis">Spending Analysis</a></h2>
<p><strong>How much did I spend on Coffee this year?</strong></p>
<pre><code class="language-sql">SELECT sum(position)
WHERE account ~ "Expenses:Food:Coffee"
  AND year(date) = 2024
</code></pre>
<p><strong>What are my top 10 expense categories?</strong></p>
<pre><code class="language-sql">SELECT account, sum(position) as total
WHERE account ~ "Expenses"
  AND year(date) = 2024
GROUP BY account
ORDER BY total DESC
LIMIT 10
</code></pre>
<h2 id="income-analysis"><a class="header" href="#income-analysis">Income Analysis</a></h2>
<p><strong>Monthly Income by Source</strong></p>
<pre><code class="language-sql">SELECT year(date), month(date), root(account, 3), sum(position)
WHERE account ~ "Income"
GROUP BY year(date), month(date), root(account, 3)
ORDER BY year(date), month(date)
</code></pre>
<h2 id="net-worth"><a class="header" href="#net-worth">Net Worth</a></h2>
<p><strong>Current Net Worth (Sum of Assets + Liabilities)</strong>
Note: Since Liabilities are negative, summing them gives the net value.</p>
<pre><code class="language-sql">SELECT sum(position)
WHERE account ~ "Assets|Liabilities"
</code></pre>
<h2 id="auditing"><a class="header" href="#auditing">Auditing</a></h2>
<p><strong>Find huge transactions (over $1000)</strong></p>
<pre><code class="language-sql">SELECT date, narration, account, position
WHERE abs(number(position)) &gt; 1000
ORDER BY date DESC
</code></pre>
<p><strong>Find transactions missing a tag</strong></p>
<pre><code class="language-sql">SELECT *
WHERE tag IS NULL
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="year-end-procedures"><a class="header" href="#year-end-procedures">Year-End Procedures</a></h1>
<p>Beancount uses <strong>Continuous Accounting</strong>, which means you do not <em>need</em> to close out your books at the end of the year like a traditional business. Your <code>Income</code> and <code>Expense</code> accounts just keep accumulating history.</p>
<p>However, many users like to perform a “Year-End Check” to lock in their history.</p>
<h2 id="1-verify-balances"><a class="header" href="#1-verify-balances">1. Verify Balances</a></h2>
<p>On Dec 31st (or Jan 1st), log into all your banks and check the exact balance. Add a <code>balance</code> assertion for <strong>every</strong> asset and liability account.</p>
<pre><code class="language-beancount">2024-01-01 balance Assets:Bank:Checking   1234.56 USD
2024-01-01 balance Liabilities:Visa      -450.00 USD
</code></pre>
<p>This ensures that no future edits can accidentally break your history for 2023.</p>
<h2 id="2-generate-reports"><a class="header" href="#2-generate-reports">2. Generate Reports</a></h2>
<p>Since you don’t zero out accounts, you must filter by date to see your annual performance.</p>
<pre><code class="language-bash"># Income Statement for 2023
bean-report main.beancount income --year=2023
</code></pre>
<h2 id="3-optional-clear-equity"><a class="header" href="#3-optional-clear-equity">3. (Optional) “Clear” Equity</a></h2>
<p>If you <em>really</em> want to zero out your Income/Expense accounts (simulating a “closing”), you can transfer their balances to <code>Equity:Retained-Earnings</code>.</p>
<p><strong>Note:</strong> This is manual and usually discouraged in Beancount because it destroys the ability to run multi-year reports easily.</p>
<h2 id="4-archive-documents"><a class="header" href="#4-archive-documents">4. Archive Documents</a></h2>
<p>If you store receipts, now is a good time to zip up the <code>2023/</code> folder.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-to-organize-your-accounts"><a class="header" href="#how-to-organize-your-accounts">How to Organize Your Accounts</a></h1>
<p>One of the first questions new users ask is “What accounts should I have?”</p>
<p>Beancount uses a hierarchical structure (separated by colons <code>:</code>) that allows you to be as general or specific as you want.</p>
<h2 id="the-five-root-types-strict-rule"><a class="header" href="#the-five-root-types-strict-rule">The Five Root Types (Strict Rule)</a></h2>
<p>You cannot rename these. Every account <strong>must</strong> start with one of these five roots:</p>
<ol>
<li><strong>Assets</strong>: Things you own that have value.
<ul>
<li><em>Examples: Bank accounts, Cash, House, Car, Stocks, Receivables (money owed to you).</em></li>
</ul>
</li>
<li><strong>Liabilities</strong>: Money you owe to others.
<ul>
<li><em>Examples: Credit Cards, Mortgage, Student Loans.</em></li>
</ul>
</li>
<li><strong>Income</strong>: Money flowing <em>in</em> to your life.
<ul>
<li><em>Examples: Salary, Interest, Dividends, Gifts Received.</em></li>
</ul>
</li>
<li><strong>Expenses</strong>: Money flowing <em>out</em> of your life (consumption).
<ul>
<li><em>Examples: Rent, Food, Taxes, Utilities, Gifts Given.</em></li>
</ul>
</li>
<li><strong>Equity</strong>: The net worth of the ledger.
<ul>
<li><em>Examples: Opening balances, Conversions, Retained Earnings.</em></li>
</ul>
</li>
</ol>
<hr>
<h2 id="example-1-simple-personal-finance"><a class="header" href="#example-1-simple-personal-finance">Example 1: Simple Personal Finance</a></h2>
<p>For most people starting out, keep it simple. Don’t over-engineer.</p>
<pre><code class="language-text">Assets:US:BofA:Checking
Assets:US:BofA:Savings
Assets:Vanguard:401k

Liabilities:US:Chase:SapphireCard

Income:US:Employer:Salary
Income:US:Bank:Interest

Expenses:Home:Rent
Expenses:Home:Utilities
Expenses:Food:Groceries
Expenses:Food:Restaurant
Expenses:Transport:Metro
Expenses:Transport:Uber
Expenses:Shopping:Clothing
Expenses:Health:Medical
</code></pre>
<h2 id="example-2-the-freelancer"><a class="header" href="#example-2-the-freelancer">Example 2: The Freelancer</a></h2>
<p>Freelancers need to separate business and personal expenses.</p>
<pre><code class="language-text">; Business Assets
Assets:Biz:PayPal
Assets:Biz:Checking

; Personal Assets
Assets:Pers:Checking

; Business Income
Income:Biz:ClientA
Income:Biz:ClientB

; Expenses
Expenses:Biz:Hosting
Expenses:Biz:Software
Expenses:Pers:Food
</code></pre>
<h2 id="tips-for-success"><a class="header" href="#tips-for-success">Tips for Success</a></h2>
<h3 id="1-geography-is-useful"><a class="header" href="#1-geography-is-useful">1. Geography is useful</a></h3>
<p>If you have accounts in multiple countries, put the country code early in the hierarchy:</p>
<ul>
<li><code>Assets:US:Chase</code></li>
<li><code>Assets:UK:Barclays</code>
This groups all your US assets together in reports.</li>
</ul>
<h3 id="2-institution-names"><a class="header" href="#2-institution-names">2. Institution Names</a></h3>
<p>Using the bank name helps you match physical statements to Beancount accounts:</p>
<ul>
<li><code>Liabilities:US:Amex:Gold</code></li>
<li><code>Liabilities:US:Amex:Platinum</code></li>
</ul>
<h3 id="3-dont-go-too-deep"><a class="header" href="#3-dont-go-too-deep">3. Don’t go too deep</a></h3>
<p>Avoid: <code>Expenses:Food:Groceries:Fruits:Bananas</code>.
Better: <code>Expenses:Food:Groceries</code>.
<em>Why?</em> If you are too specific, classifying transactions becomes a chore. You can always use <code>#tags</code> for temporary specificity (like <code>#wedding</code> or <code>#renovation</code>).</p>
<h3 id="4-group-by-fixed-vs-variable"><a class="header" href="#4-group-by-fixed-vs-variable">4. Group by Fixed vs Variable</a></h3>
<p>Some users like to separate fixed bills from discretionary spending:</p>
<ul>
<li><code>Expenses:Fixed:Rent</code></li>
<li><code>Expenses:Fixed:Internet</code></li>
<li><code>Expenses:Variable:Dining</code></li>
<li><code>Expenses:Variable:Hobbies</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-to-run-reports"><a class="header" href="#how-to-run-reports">How to Run Reports</a></h1>
<p>Beancount is a command-line tool. While you can use GUIs like <a href="https://beancount.github.io/fava/">Fava</a> (a separate web interface for Beancount), understanding the CLI tools gives you the most power.</p>
<h2 id="the-main-command-bean-report"><a class="header" href="#the-main-command-bean-report">The Main Command: <code>bean-report</code></a></h2>
<p>The basic syntax is:
<code>bean-report [filename] [report-name]</code></p>
<h3 id="1-balances-the-snapshot"><a class="header" href="#1-balances-the-snapshot">1. <code>balances</code> (The Snapshot)</a></h3>
<p>Shows the final balance of every account at the end of history.</p>
<pre><code class="language-bash">bean-report main.beancount balances
</code></pre>
<p><strong>Common Flags:</strong></p>
<ul>
<li><code>--at=2023-01-01</code>: See what the balances were on a specific date.</li>
</ul>
<h3 id="2-income-the-pl"><a class="header" href="#2-income-the-pl">2. <code>income</code> (The P&amp;L)</a></h3>
<p>Shows your profit and loss (Income and Expenses) for the period. By default, it calculates the total for the entire history of the file.</p>
<pre><code class="language-bash">bean-report main.beancount income
</code></pre>
<p><strong>Common Flags:</strong></p>
<ul>
<li><code>--begin=2023-01-01</code>: Start calculating from this date.</li>
<li><code>--end=2024-01-01</code>: Stop calculating at this date.</li>
</ul>
<h3 id="3-check"><a class="header" href="#3-check">3. <code>check</code></a></h3>
<p>Validates the file (same as <code>bean-check</code>).</p>
<pre><code class="language-bash">bean-report main.beancount check
</code></pre>
<hr>
<h2 id="the-sql-interface-bean-query"><a class="header" href="#the-sql-interface-bean-query">The SQL Interface: <code>bean-query</code></a></h2>
<p>For custom reports, Beancount provides a SQL-like query language. This is incredibly powerful.</p>
<p>Start the interactive shell:</p>
<pre><code class="language-bash">bean-query main.beancount
</code></pre>
<p>Then type your query:</p>
<p><strong>Example 1: Find all coffee purchases</strong></p>
<pre><code class="language-sql">SELECT date, narration, amount
WHERE account ~ "Expenses:Food" AND narration ~ "Coffee"
</code></pre>
<p><strong>Example 2: Monthly spending on Food</strong></p>
<pre><code class="language-sql">SELECT year(date), month(date), sum(position)
WHERE account ~ "Expenses:Food"
GROUP BY year(date), month(date)
</code></pre>
<p><strong>Example 3: Export to CSV</strong>
You can run a query directly from the command line and save it to a CSV file for Excel/Google Sheets.</p>
<pre><code class="language-bash">bean-query main.beancount 'HBOX "SELECT * WHERE account ~ 'Assets' "' -f csv &gt; assets.csv
</code></pre>
<hr>
<h2 id="visualizing-with-fava"><a class="header" href="#visualizing-with-fava">Visualizing with Fava</a></h2>
<p>While not part of the core Beancount tool, almost every user installs <strong>Fava</strong>. It is a web interface that runs locally.</p>
<p>For a detailed guide on using its charts and filters, see <a href="#using-fava-web-ui">Using Fava (Web UI)</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="using-fava-web-ui"><a class="header" href="#using-fava-web-ui">Using Fava (Web UI)</a></h1>
<p><strong>Fava</strong> is the standard web interface for Beancount. It transforms your text file into an interactive financial dashboard.</p>
<h2 id="installation--start"><a class="header" href="#installation--start">Installation &amp; Start</a></h2>
<pre><code class="language-bash">pip install fava
fava main.beancount
</code></pre>
<p>Open <code>http://localhost:5000</code> in your browser.</p>
<blockquote>
<p><strong>Tip:</strong> Press <code>?</code> anywhere in Fava to see keyboard shortcuts.</p>
</blockquote>
<hr>
<h2 id="the-dashboard-indicators"><a class="header" href="#the-dashboard-indicators">The Dashboard (Indicators)</a></h2>
<p>The dashboard shows your Net Worth and upcoming events.</p>
<h3 id="up-to-date-indicators"><a class="header" href="#up-to-date-indicators">Up-to-Date Indicators</a></h3>
<p>Fava can show colored dots next to accounts to indicate if they have been reconciled recently.</p>
<p>To enable this, add metadata to your <code>open</code> directive:</p>
<pre><code class="language-beancount">2000-01-01 open Assets:Bank:Chase
  fava-uptodate-indication: TRUE
</code></pre>
<ul>
<li>🟢 <strong>Green</strong>: The last entry is a passed balance check.</li>
<li>🔴 <strong>Red</strong>: The last entry is a failed balance check.</li>
<li>🟡 <strong>Yellow</strong>: The last entry is not a balance check.</li>
<li>⚪ <strong>Grey</strong>: No activity for a long time (default 60 days).</li>
</ul>
<hr>
<h2 id="filtering"><a class="header" href="#filtering">Filtering</a></h2>
<p>Fava’s filter bar is extremely powerful.</p>
<h3 id="time-filter"><a class="header" href="#time-filter">Time Filter</a></h3>
<p>Supports natural language and intervals:</p>
<ul>
<li><code>2024</code>: The whole year.</li>
<li><code>2024-Q1</code>: First quarter.</li>
<li><code>2024-03</code>: March.</li>
<li><code>year - 1</code>: Last year.</li>
<li><code>month</code>: This month.</li>
</ul>
<h3 id="account-filter"><a class="header" href="#account-filter">Account Filter</a></h3>
<p>Accepts regular expressions to match account names:</p>
<ul>
<li><code>Assets:US</code> matches all US assets.</li>
<li><code>^Assets</code> matches only Assets (no Income/Expenses).</li>
</ul>
<h3 id="advanced-filter"><a class="header" href="#advanced-filter">Advanced Filter</a></h3>
<p>Filter by tags, links, metadata, or amounts.</p>
<ul>
<li><code>#vacation</code>: Only show transactions with this tag.</li>
<li><code>payee:"Starbucks"</code>: Filter by payee.</li>
<li><code>units &gt; 100</code>: Only transactions larger than 100.</li>
<li><code>any(account:"Expenses:Food")</code>: Entries where <em>at least one</em> posting hits food.</li>
<li><code>all(-account:"Expenses")</code>: Exclude all expenses.</li>
</ul>
<hr>
<h2 id="the-editor"><a class="header" href="#the-editor">The Editor</a></h2>
<p>Fava includes a full Beancount text editor in the browser.</p>
<ul>
<li><strong>Auto-complete</strong>: Type an account name or payee to see suggestions.</li>
<li><strong>Validation</strong>: Errors are highlighted in red immediately.</li>
<li><strong>Formatting</strong>: Use <code>Align Amounts</code> to clean up your file.</li>
</ul>
<hr>
<h2 id="importing-data"><a class="header" href="#importing-data">Importing Data</a></h2>
<p>Fava provides a GUI for <code>beangulp</code> importers.</p>
<ol>
<li>Configure your importers in python (see <a href="#writing-importers-with-beangulp">Writing Importers</a>).</li>
<li>Add the configuration to your file:
<pre><code class="language-beancount">custom "fava-option" "import-config" "my_import_config.py"
custom "fava-option" "import-dirs" "/path/to/downloads"
</code></pre>
</li>
<li>Go to the <strong>Import</strong> tab in Fava.</li>
<li>Drag and drop CSV files onto the importer name.</li>
<li>Fava will extract transactions and let you review/accept them before writing to your file.</li>
</ol>
<hr>
<h2 id="configuration-options"><a class="header" href="#configuration-options">Configuration Options</a></h2>
<p>Fava has its own set of options defined using the <code>custom</code> directive.</p>
<h3 id="fiscal-year"><a class="header" href="#fiscal-year">Fiscal Year</a></h3>
<p>Change the start of your year (e.g., UK tax year starts April 6).</p>
<pre><code class="language-beancount">custom "fava-option" "fiscal-year-end" "04-05"
</code></pre>
<h3 id="invert-signs"><a class="header" href="#invert-signs">Invert Signs</a></h3>
<p>If you prefer to see Income/Liabilities as positive numbers (Net Profit view):</p>
<pre><code class="language-beancount">custom "fava-option" "invert-income-liabilities-equity" "true"
</code></pre>
<h3 id="language"><a class="header" href="#language">Language</a></h3>
<p>Force a specific language (default is auto-detected).</p>
<pre><code class="language-beancount">custom "fava-option" "language" "fr"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="writing-importers-with-beangulp"><a class="header" href="#writing-importers-with-beangulp">Writing Importers with Beangulp</a></h1>
<p>Beancount 3 uses a separate library called <code>beangulp</code> for importing data. Beangulp provides a framework to extract transactions from external files (like CSVs or PDFs) and convert them into Beancount directives.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>You need to install <code>beangulp</code>:</p>
<pre><code class="language-bash">pip install beangulp
</code></pre>
<h2 id="the-importer-protocol"><a class="header" href="#the-importer-protocol">The Importer Protocol</a></h2>
<p>To create a custom importer, you must subclass <code>beangulp.Importer</code> and implement these methods:</p>
<ol>
<li><code>identify(self, filepath)</code>: Returns <code>True</code> if this importer can handle the given file.</li>
<li><code>extract(self, filepath, existing)</code>: Parses the file and returns a list of Beancount entries.</li>
<li><code>account(self, filepath)</code>: Returns the account associated with this file (used for filing).</li>
<li><code>date(self, filepath)</code>: Returns the date associated with this file (used for filing).</li>
</ol>
<h2 id="example-a-simple-csv-importer"><a class="header" href="#example-a-simple-csv-importer">Example: A Simple CSV Importer</a></h2>
<p>Let’s say you have a bank CSV that looks like this:</p>
<pre><code class="language-csv">Date,Description,Amount
2024-01-15,Coffee Shop,-5.00
2024-01-16,Salary,3000.00
</code></pre>
<p>Here is a complete importer for this format.</p>
<pre><code class="language-python">import csv
from datetime import datetime
from beangulp import Importer
from beancount.core import data, amount
from decimal import Decimal

class MyBankImporter(Importer):
    def __init__(self, account_name):
        self.account_name = account_name

    def identify(self, filepath):
        # Only accept CSV files
        if not filepath.endswith(".csv"):
            return False
            
        # Peek at the header to be sure
        with open(filepath) as f:
            header = f.readline().strip()
        return header == "Date,Description,Amount"

    def account(self, filepath):
        return self.account_name

    def date(self, filepath):
        # Optional: Extract the date from the filename or the last transaction
        # For simplicity, we'll return the date of the last transaction in the file
        last_date = None
        with open(filepath) as f:
            reader = csv.DictReader(f)
            for row in reader:
                last_date = datetime.strptime(row['Date'], '%Y-%m-%d').date()
        return last_date

    def extract(self, filepath, existing=None):
        entries = []
        
        with open(filepath) as f:
            reader = csv.DictReader(f)
            for row in reader:
                # 1. Parse metadata
                date = datetime.strptime(row['Date'], '%Y-%m-%d').date()
                desc = row['Description']
                amt = Decimal(row['Amount'])
                
                # 2. Create the transaction
                meta = data.new_metadata(filepath, reader.line_num)
                txn = data.Transaction(
                    meta, date, "*", None, desc, data.EMPTY_SET, data.EMPTY_SET, []
                )

                # 3. Add postings
                # The main posting (the bank account)
                txn.postings.append(
                    data.Posting(self.account_name, amount.Amount(amt, "USD"), 
                               None, None, None, None)
                )
                
                # The other side (usually an expense placeholder)
                # We leave the amount empty so Beancount can balance it automatically
                txn.postings.append(
                    data.Posting("Expenses:Unknown", None, 
                               None, None, None, None)
                )

                entries.append(txn)
                
        return entries
</code></pre>
<h2 id="extracting-data-from-pdfs"><a class="header" href="#extracting-data-from-pdfs">Extracting Data from PDFs</a></h2>
<p>Sometimes banks only provide PDF statements. Extracting data from them is harder but possible using tools like <code>pdftotext</code>.</p>
<h3 id="1-install-dependencies"><a class="header" href="#1-install-dependencies">1. Install Dependencies</a></h3>
<p>You need the <code>poppler-utils</code> package installed on your system.</p>
<ul>
<li><strong>Debian/Ubuntu</strong>: <code>sudo apt install poppler-utils</code></li>
<li><strong>macOS</strong>: <code>brew install poppler</code></li>
<li><strong>Nix</strong>: <code>nix-env -iA nixpkgs.poppler_utils</code></li>
</ul>
<h3 id="2-calling-pdftotext"><a class="header" href="#2-calling-pdftotext">2. Calling <code>pdftotext</code></a></h3>
<p>Use Python’s <code>subprocess</code> to run the command and capture the output. The <code>-layout</code> flag is crucial as it preserves the visual structure of the table.</p>
<pre><code class="language-python">import subprocess

def extract_pdf_text(filepath):
    # Run pdftotext -layout input.pdf -
    # The '-' at the end tells it to print to stdout
    result = subprocess.run(
        ['pdftotext', '-layout', filepath, '-'], 
        stdout=subprocess.PIPE, 
        text=True
    )
    return result.stdout
</code></pre>
<h3 id="3-parsing-the-output"><a class="header" href="#3-parsing-the-output">3. Parsing the Output</a></h3>
<p>Once you have the text string, you iterate over the lines and use Regular Expressions (Regex) to find transaction rows.</p>
<pre><code class="language-python">import re

# Example Regex for a line like: "Jan 01   Grocery Store   -50.00"
# (\w+ \d+)   : Date (Group 1)
# \s+         : Spaces
# (.*?)       : Description (Group 2)
# \s+         : Spaces
# (-?[\d\.]+) : Amount (Group 3)
TXN_REGEX = re.compile(r'(\w+ \d+)\s+(.*?)\s+(-?[\d\.]+)')

def parse_text(text):
    for line in text.splitlines():
        match = TXN_REGEX.search(line)
        if match:
            date_str, desc, amount_str = match.groups()
            # ... create transaction object ...
</code></pre>
<h2 id="running-your-import"><a class="header" href="#running-your-import">Running Your Import</a></h2>
<p>Create a configuration script (e.g., <code>import.py</code>) to run your importers.</p>
<pre><code class="language-python">from beangulp import Ingest
import my_importers

ingest = Ingest()
ingest.add(my_importers.MyBankImporter("Assets:Bank:Checking"))

if __name__ == "__main__":
    ingest()
</code></pre>
<p>You can now run this script to generate beancount entries:</p>
<pre><code class="language-bash">python3 import.py /path/to/downloaded.csv
</code></pre>
<h2 id="best-practices-1"><a class="header" href="#best-practices-1">Best Practices</a></h2>
<ul>
<li><strong>Use <code>beangulp.testing</code></strong>: Beangulp includes utilities to test your importers against sample files.</li>
<li><strong>Smart Categorization</strong>: You can add logic in <code>extract</code> to guess the expense account based on the description (e.g., if “Coffee” in description, use <code>Expenses:Food:Coffee</code>).</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="beancount-3-syntax-reference"><a class="header" href="#beancount-3-syntax-reference">Beancount 3 Syntax Reference</a></h1>
<p>Beancount uses a precise but simple text format.</p>
<h2 id="general-rules"><a class="header" href="#general-rules">General Rules</a></h2>
<ul>
<li><strong>Indentation</strong>: Postings must be indented (usually 2 spaces). Directives must start at the beginning of the line.</li>
<li><strong>Comments</strong>: Any text following a <code>;</code> is ignored.</li>
<li><strong>Strings</strong>: Payees and Narrations must be in double quotes <code>"</code>.</li>
</ul>
<h2 id="directives"><a class="header" href="#directives">Directives</a></h2>
<h3 id="1-option"><a class="header" href="#1-option">1. <code>option</code></a></h3>
<p>Configures global settings.</p>
<pre><code class="language-beancount">option "title" "My Finances"
</code></pre>
<h3 id="2-plugin"><a class="header" href="#2-plugin">2. <code>plugin</code></a></h3>
<p>Loads Python extensions.</p>
<pre><code class="language-beancount">plugin "beancount.plugins.auto_accounts"
</code></pre>
<h3 id="3-open"><a class="header" href="#3-open">3. <code>open</code></a></h3>
<p>Initializes an account. Usually dated before the first transaction.</p>
<pre><code class="language-beancount">2000-01-01 open Assets:Bank:Chase
</code></pre>
<p>You can also restrict the currencies allowed in an account:</p>
<pre><code class="language-beancount">2000-01-01 open Assets:Bank:Chase USD, EUR
</code></pre>
<p><strong>Syntax:</strong> <code>open Account [Constraint1, Constraint2] ["BookingMethod"]</code></p>
<h3 id="4-close"><a class="header" href="#4-close">4. <code>close</code></a></h3>
<p>Marks an account as closed. The balance <em>must</em> be zero on this date.</p>
<pre><code class="language-beancount">2024-12-31 close Assets:Bank:OldAccount
</code></pre>
<h3 id="5-commodity"><a class="header" href="#5-commodity">5. <code>commodity</code></a></h3>
<p>Declares a currency or commodity. Optional, but useful for metadata.</p>
<pre><code class="language-beancount">1998-01-01 commodity USD
  name: "US Dollar"
</code></pre>
<h3 id="6-price"><a class="header" href="#6-price">6. <code>price</code></a></h3>
<p>Records the market price of a commodity on a specific date.</p>
<pre><code class="language-beancount">2024-06-01 price AAPL 155.00 USD
</code></pre>
<h3 id="7-balance"><a class="header" href="#7-balance">7. <code>balance</code></a></h3>
<p>Asserts that the balance of an account matches a number <em>at the end of that day</em>.</p>
<pre><code class="language-beancount">2024-01-01 balance Assets:Bank:Chase 1500.00 USD
</code></pre>
<h3 id="8-pad"><a class="header" href="#8-pad">8. <code>pad</code></a></h3>
<p>Automatically inserts a transaction to make the balance of an account match a future <code>balance</code> directive.
The difference is booked to the source account provided.</p>
<pre><code class="language-beancount">; Calculate the difference needed to reach the next balance check
; and book it to Equity:Opening-Balances
2024-01-01 pad Assets:Bank:Chase Equity:Opening-Balances

2024-01-02 balance Assets:Bank:Chase 1500.00 USD
</code></pre>
<p><em>Use with caution!</em> It effectively hides missing transactions.</p>
<h3 id="9-custom"><a class="header" href="#9-custom">9. <code>custom</code></a></h3>
<p>Used to define generic directives that can be handled by scripts or plugins.</p>
<pre><code class="language-beancount">2024-01-01 custom "budget" "Expenses:Food" "monthly" 500.00 USD
</code></pre>
<hr>
<h2 id="the-transaction-block"><a class="header" href="#the-transaction-block">The Transaction Block</a></h2>
<p>The most common block in the file.</p>
<blockquote>
<p><strong>Examples:</strong> See <a href="#how-to-record-transactions">Recording Transactions</a> for practical examples.</p>
</blockquote>
<pre><code class="language-beancount">YYYY-MM-DD flag "Payee" "Narration" #tag ^link
  meta-key: meta-value
  Account1    Amount1 Currency
  Account2    Amount2 Currency
</code></pre>
<ul>
<li><strong>Flag</strong>: <code>*</code> (Completed) or <code>!</code> (Incomplete).</li>
<li><strong>Payee/Narration</strong>: At least one string is required. Beancount assumes the first string is the payee if there are two strings, or just the narration if there is only one.</li>
<li><strong>Tags</strong>: <code>#tagname</code>. Used for categorization.</li>
<li><strong>Links</strong>: <code>^linkname</code>. Used to group transactions.</li>
<li><strong>Metadata</strong>: Key-value pairs. Values can be strings, numbers, dates, or booleans.</li>
</ul>
<h2 id="balancing-rules"><a class="header" href="#balancing-rules">Balancing Rules</a></h2>
<p>Beancount enforces that every transaction sums to zero.</p>
<ul>
<li><strong>Amount Only</strong>: Weight is simply the amount (e.g., <code>10 USD</code>).</li>
<li><strong>Cost</strong>: Weight is <code>Amount * Cost</code> (e.g., <code>10 STOCK {100 USD}</code> = <code>1000 USD</code>).</li>
<li><strong>Price</strong>: Weight is <code>Amount * Price</code> (e.g., <code>10 EUR @ 1.2 USD</code> = <code>12 USD</code>).</li>
<li><strong>Cost &amp; Price</strong>: Price is <strong>ignored</strong> for balancing. Weight is <code>Amount * Cost</code>.</li>
</ul>
<h3 id="cost-basis--and-price-"><a class="header" href="#cost-basis--and-price-">Cost Basis <code>{}</code> and Price <code>@</code></a></h3>
<p>Used for trading and conversions.</p>
<ul>
<li><code>{10.00 USD}</code>: <strong>Cost</strong>. I bought this item for 10 USD.</li>
<li><code>@ 12.00 USD</code>: <strong>Price</strong>. The market value of this item is 12 USD per unit.</li>
<li><code>@@ 120.00 USD</code>: <strong>Total Price</strong>. The total value of the entire lot is 120 USD.</li>
</ul>
<p>Example: Buying 10 shares at $10 each.</p>
<pre><code class="language-beancount">2024-01-01 * "Buy Stock"
  Assets:Brokerage      10 STOCK {10.00 USD}
  Assets:Cash         -100.00 USD
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="options-reference"><a class="header" href="#options-reference">Options Reference</a></h1>
<p>Global options configure how Beancount parses and validates your file.</p>
<p>Usage:</p>
<pre><code class="language-beancount">option "key" "value"
</code></pre>
<h2 id="essential-options"><a class="header" href="#essential-options">Essential Options</a></h2>
<h3 id="title"><a class="header" href="#title"><code>title</code></a></h3>
<p>The title of your ledger, used in reports.</p>
<pre><code class="language-beancount">option "title" "My Personal Finances"
</code></pre>
<h3 id="operating_currency"><a class="header" href="#operating_currency"><code>operating_currency</code></a></h3>
<p>Defines the currencies that are “yours”. This affects how reports aggregate numbers. You can specify this multiple times.</p>
<pre><code class="language-beancount">option "operating_currency" "USD"
option "operating_currency" "EUR"
</code></pre>
<h2 id="parsing--accuracy"><a class="header" href="#parsing--accuracy">Parsing &amp; Accuracy</a></h2>
<h3 id="tolerance"><a class="header" href="#tolerance"><code>tolerance</code></a></h3>
<p>Sets the inferred tolerance for balancing transactions. Defaults to 0.005 for most currencies.</p>
<pre><code class="language-beancount">option "tolerance" "0.01"
</code></pre>
<h3 id="account_rounding"><a class="header" href="#account_rounding"><code>account_rounding</code></a></h3>
<p>Automatically inserts a rounding posting to an Equity account if a transaction is off by a tiny amount (due to currency conversion).</p>
<pre><code class="language-beancount">option "account_rounding" "Equity:Rounding"
</code></pre>
<h2 id="classification"><a class="header" href="#classification">Classification</a></h2>
<h3 id="documents"><a class="header" href="#documents"><code>documents</code></a></h3>
<p>A list of directories where Beancount should look for external documents (PDFs) to link to transactions.</p>
<pre><code class="language-beancount">option "documents" "/home/user/finances/docs"
</code></pre>
<h3 id="account_previous_balances"><a class="header" href="#account_previous_balances"><code>account_previous_balances</code></a></h3>
<p>Beancount can calculate the balance of an account before the first transaction based on <code>open</code> date.</p>
<pre><code class="language-beancount">option "account_previous_balances" "Opening-Balances"
</code></pre>
<h2 id="formatting"><a class="header" href="#formatting">Formatting</a></h2>
<h3 id="render_commas"><a class="header" href="#render_commas"><code>render_commas</code></a></h3>
<p>Whether to render numbers with thousands separators in reports (TRUE/FALSE).</p>
<pre><code class="language-beancount">option "render_commas" "TRUE"
</code></pre>
<h3 id="plugin_processing_mode"><a class="header" href="#plugin_processing_mode"><code>plugin_processing_mode</code></a></h3>
<p>“default” or “raw”. Determines when plugins run. usually “default”.</p>
<pre><code class="language-beancount">option "plugin_processing_mode" "default"
</code></pre>
<h2 id="root-account-naming-localization"><a class="header" href="#root-account-naming-localization">Root Account Naming (Localization)</a></h2>
<p>You can rename the five standard root accounts to suit your language or preference.</p>
<h3 id="name_assets-name_liabilities-name_equity-name_income-name_expenses"><a class="header" href="#name_assets-name_liabilities-name_equity-name_income-name_expenses"><code>name_assets</code>, <code>name_liabilities</code>, <code>name_equity</code>, <code>name_income</code>, <code>name_expenses</code></a></h3>
<p>Override the default names.</p>
<pre><code class="language-beancount">option "name_assets"      "Actifs"
option "name_liabilities" "Passifs"
option "name_equity"      "Capitaux"
option "name_income"      "Revenus"
option "name_expenses"    "Depenses"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="beancount-query-language-bql"><a class="header" href="#beancount-query-language-bql">Beancount Query Language (BQL)</a></h1>
<p>BQL is a SQL-like language for querying Beancount data.</p>
<h2 id="syntax"><a class="header" href="#syntax">Syntax</a></h2>
<pre><code class="language-sql">SELECT &lt;targets&gt;
FROM &lt;entry-filter&gt;
WHERE &lt;posting-filter&gt;
GROUP BY &lt;groupings&gt;
ORDER BY &lt;ordering&gt;
LIMIT &lt;number&gt;
</code></pre>
<h2 id="clauses"><a class="header" href="#clauses">Clauses</a></h2>
<h3 id="select"><a class="header" href="#select"><code>SELECT</code></a></h3>
<p>Comma-separated list of columns or functions.</p>
<ul>
<li><code>SELECT date, account, position</code></li>
<li><code>SELECT last(date), cost(sum(position))</code></li>
</ul>
<h3 id="from"><a class="header" href="#from"><code>FROM</code></a></h3>
<p>Filters whole transactions (entries). If a transaction matches, <strong>all</strong> its postings are considered for the <code>WHERE</code> clause.</p>
<ul>
<li><code>FROM has_tag('trip')</code></li>
<li><code>FROM year = 2024</code></li>
</ul>
<h3 id="where"><a class="header" href="#where"><code>WHERE</code></a></h3>
<p>Filters individual postings.</p>
<ul>
<li><code>WHERE account ~ "Expenses:Food"</code></li>
<li><code>WHERE currency = "USD"</code></li>
</ul>
<h3 id="group-by"><a class="header" href="#group-by"><code>GROUP BY</code></a></h3>
<p>Aggregates results. Required if using aggregate functions like <code>SUM</code>.</p>
<ul>
<li><code>GROUP BY account</code></li>
<li><code>GROUP BY 1, 2</code> (Column indices)</li>
</ul>
<h2 id="functions-1"><a class="header" href="#functions-1">Functions</a></h2>
<h3 id="simple-functions"><a class="header" href="#simple-functions">Simple Functions</a></h3>
<ul>
<li><code>COST(pos)</code>: Returns the cost amount of a position.</li>
<li><code>UNITS(pos)</code>: Returns the units (number) of a position.</li>
<li><code>DAY(date)</code>, <code>MONTH(date)</code>, <code>YEAR(date)</code>: Extract date parts.</li>
<li><code>PARENT(account)</code>: Returns the parent account name.</li>
<li><code>ABS(num)</code>: Absolute value.</li>
<li><code>NEG(num)</code>: Negate.</li>
</ul>
<h3 id="aggregate-functions"><a class="header" href="#aggregate-functions">Aggregate Functions</a></h3>
<ul>
<li><code>SUM(pos)</code>: Sums positions (handles mixed currencies).</li>
<li><code>COUNT(pos)</code>: Counts rows.</li>
<li><code>MIN(val)</code>, <code>MAX(val)</code>: Minimum/Maximum.</li>
<li><code>FIRST(val)</code>, <code>LAST(val)</code>: First/Last value in the group.</li>
</ul>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<p><strong>Holdings (at Cost)</strong></p>
<pre><code class="language-sql">SELECT account, sum(cost(position))
WHERE account ~ "Assets"
GROUP BY account
</code></pre>
<p><strong>Income Statement (2024)</strong></p>
<pre><code class="language-sql">SELECT account, sum(position)
WHERE account ~ "Income|Expenses" AND year = 2024
GROUP BY account
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="standard-plugins"><a class="header" href="#standard-plugins">Standard Plugins</a></h1>
<p>Beancount includes several plugins that automate common tasks. To use them, add <code>plugin "..."</code> to your file.</p>
<h2 id="beancountpluginsauto_accounts"><a class="header" href="#beancountpluginsauto_accounts"><code>beancount.plugins.auto_accounts</code></a></h2>
<p><strong>Description</strong>: Automatically creates <code>open</code> directives for accounts that are referenced but not defined.
<strong>Usage</strong>: Great for lazy prototyping, but discouraged for strict accounting.</p>
<pre><code class="language-beancount">plugin "beancount.plugins.auto_accounts"
</code></pre>
<h2 id="beancountpluginstag_pending"><a class="header" href="#beancountpluginstag_pending"><code>beancount.plugins.tag_pending</code></a></h2>
<p><strong>Description</strong>: Automatically adds a <code>#pending</code> tag to any transaction marked with the <code>!</code> flag.
<strong>Usage</strong>: clear visualization of what is not yet cleared.</p>
<pre><code class="language-beancount">plugin "beancount.plugins.tag_pending"
</code></pre>
<h2 id="beancountpluginsforecast"><a class="header" href="#beancountpluginsforecast"><code>beancount.plugins.forecast</code></a></h2>
<p><strong>Description</strong>: Generates recurring transactions into the future for budgeting/planning.
<strong>Usage</strong>: You define a “forecast” transaction, and the plugin projects it forward.</p>
<h2 id="beancountpluginscheck_commodity"><a class="header" href="#beancountpluginscheck_commodity"><code>beancount.plugins.check_commodity</code></a></h2>
<p><strong>Description</strong>: Ensures that all commodities used in an account match the <code>open</code> directive restrictions.
<strong>Usage</strong>: Strict validation.</p>
<pre><code class="language-beancount">2000-01-01 open Assets:Bank:US USD
; This will fail if you try to put EUR in it
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="beancount-3-command-line-interface"><a class="header" href="#beancount-3-command-line-interface">Beancount 3 Command Line Interface</a></h1>
<p>Beancount 3 provides several tools to interact with your ledger files.</p>
<h2 id="bean-check"><a class="header" href="#bean-check">bean-check</a></h2>
<p>This is the most important command. It checks your file for syntax errors and balance mistakes.</p>
<pre><code class="language-bash">bean-check my_ledger.beancount
</code></pre>
<p>If there are no errors, the command will produce no output.</p>
<h2 id="bean-report"><a class="header" href="#bean-report">bean-report</a></h2>
<p>Generates reports from your data. Common reports include:</p>
<ul>
<li><code>balances</code>: Shows the balance of all accounts.</li>
<li><code>income</code>: Shows your income and expenses.</li>
</ul>
<pre><code class="language-bash">bean-report my_ledger.beancount balances
</code></pre>
<h2 id="bean-query"><a class="header" href="#bean-query">bean-query</a></h2>
<p>Allows you to run SQL-like queries on your transactions. This is very powerful for custom analysis.</p>
<pre><code class="language-bash">bean-query my_ledger.beancount "SELECT date, narration, amount WHERE account ~ 'Expenses'"
</code></pre>
<h2 id="bean-format"><a class="header" href="#bean-format">bean-format</a></h2>
<p>Automatically cleans up your ledger file by aligning amounts and sorting directives where possible.</p>
<pre><code class="language-bash">bean-format my_ledger.beancount
</code></pre>
<blockquote>
<p><strong>Note</strong>: Beancount 3 focuses on performance and correctness. Always ensure you are running the version compatible with your installation by checking <code>beancount --version</code>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="double-entry-principles"><a class="header" href="#double-entry-principles">Double-Entry Principles</a></h1>
<p>Beancount enforces <strong>Double-Entry Bookkeeping</strong>. This system, codified by Luca Pacioli in 1494, is the standard for businesses worldwide because it is the only way to ensure mathematical consistency in financial records.</p>
<h2 id="the-fundamental-rule-sum--0"><a class="header" href="#the-fundamental-rule-sum--0">The fundamental rule: Sum = 0</a></h2>
<p>In single-entry accounting (like a simple checkbook register), you just write down “Spent $50”. But where did that $50 come from? Did you pay cash? Credit card? Gift card?</p>
<p>In double-entry, you must describe the <strong>movement</strong> of value.</p>
<ul>
<li>Value came FROM somewhere.</li>
<li>Value went TO somewhere.</li>
</ul>
<p>Beancount models this mathematically: <strong>The sum of all postings in a transaction must be zero.</strong></p>
<p>If you move $10 from your Left Pocket (<code>-10</code>) to your Right Pocket (<code>+10</code>), the total change in your wealth is zero (<code>-10 + 10 = 0</code>).</p>
<h2 id="the-five-buckets"><a class="header" href="#the-five-buckets">The Five Buckets</a></h2>
<p>Everything in accounting fits into one of five buckets. In Beancount, we use positive and negative numbers to represent these, which simplifies the math.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th style="text-align: left">Category</th><th style="text-align: left">Normal Sign</th><th style="text-align: left">Interpretation</th></tr>
</thead>
<tbody>
<tr><td style="text-align: left"><strong>Assets</strong></td><td style="text-align: left">Positive (+)</td><td style="text-align: left">Money you <strong>have</strong> (Cash, Bank, House)</td></tr>
<tr><td style="text-align: left"><strong>Liabilities</strong></td><td style="text-align: left">Negative (-)</td><td style="text-align: left">Money you <strong>owe</strong> (Credit Cards, Loans)</td></tr>
<tr><td style="text-align: left"><strong>Income</strong></td><td style="text-align: left">Negative (-)</td><td style="text-align: left">Money you <strong>earned</strong> (Salary, Interest)</td></tr>
<tr><td style="text-align: left"><strong>Expenses</strong></td><td style="text-align: left">Positive (+)</td><td style="text-align: left">Money you <strong>spent</strong> (Food, Rent)</td></tr>
<tr><td style="text-align: left"><strong>Equity</strong></td><td style="text-align: left">Negative (-)</td><td style="text-align: left">Your <strong>Net Worth</strong> (Assets - Liabilities)</td></tr>
</tbody>
</table>
</div>
<h3 id="why-is-income-negative"><a class="header" href="#why-is-income-negative">Why is Income negative?</a></h3>
<p>This is often the most confusing part for beginners. Think of it this way:</p>
<p><strong>Income is money leaving the “External World” and entering “Your World”.</strong></p>
<p>When your employer pays you $1000:</p>
<ol>
<li>They lose $1000. Beancount tracks this as <code>Income:Salary</code> with a value of <code>-1000</code>.</li>
<li>You gain $1000. Your <code>Assets:Checking</code> goes up by <code>+1000</code>.</li>
</ol>
<p><code>-1000 (Income) + 1000 (Asset) = 0</code>. The transaction balances.</p>
<h3 id="why-are-expenses-positive"><a class="header" href="#why-are-expenses-positive">Why are Expenses positive?</a></h3>
<p>When you buy coffee for $5:</p>
<ol>
<li>You lose $5 cash. <code>Assets:Cash</code> is <code>-5</code>.</li>
<li>You gain $5 worth of “Coffee Value”. <code>Expenses:Food</code> is <code>+5</code>.</li>
</ol>
<p><code>-5 (Asset) + 5 (Expense) = 0</code>.</p>
<h2 id="the-equity-equation"><a class="header" href="#the-equity-equation">The Equity Equation</a></h2>
<p>Because all transactions sum to zero, the sum of ALL accounts in your file must also equal zero at all times.</p>
<p><code>Assets + Liabilities + Income + Expenses + Equity = 0</code></p>
<p>If we rearrange this, we get the definition of Net Worth:</p>
<p><code>(Assets + Liabilities) + (Income + Expenses) + Equity = 0</code></p>
<ul>
<li><code>(Assets + Liabilities)</code> is your current wealth.</li>
<li><code>(Income + Expenses)</code> is your profit for the year.</li>
<li><code>Equity</code> is your historical wealth.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="continuous-accounting"><a class="header" href="#continuous-accounting">Continuous Accounting</a></h1>
<p>Traditional accounting software (and corporate accounting) relies on <strong>Fiscal Years</strong>. At the end of the year, accountants “close the books.”</p>
<p>This involves:</p>
<ol>
<li>Summing up all Income and Expenses.</li>
<li>Moving that net profit/loss to <code>Equity:Retained-Earnings</code>.</li>
<li>Resetting Income and Expenses to zero for Jan 1st.</li>
</ol>
<h2 id="why-beancount-is-different"><a class="header" href="#why-beancount-is-different">Why Beancount is Different</a></h2>
<p>Beancount uses <strong>Continuous Accounting</strong>. It never resets accounts to zero.</p>
<h3 id="advantages"><a class="header" href="#advantages">Advantages</a></h3>
<ol>
<li><strong>Multi-Year Reporting</strong>: You can run a report for “The last 18 months” or “2010 to 2020” instantly. In a closed system, this requires stitching together multiple closed files.</li>
<li><strong>Simplicity</strong>: You don’t have to create complex “closing entries” every year.</li>
<li><strong>Data Integrity</strong>: Your file is a single, unbroken stream of history.</li>
</ol>
<h3 id="how-it-works"><a class="header" href="#how-it-works">How it works</a></h3>
<p>When you want to see your income for just 2024, you don’t look at the raw balance (which is “All Income since the beginning of time”). Instead, you ask Beancount to <strong>calculate the change</strong> in balance between Jan 1, 2024, and Dec 31, 2024.</p>
<p>CLI tools do this automatically when you pass <code>--year=2024</code>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="trade-vs-settlement-dates"><a class="header" href="#trade-vs-settlement-dates">Trade vs. Settlement Dates</a></h1>
<p>In financial markets, a transaction happens in two distinct stages:</p>
<ol>
<li><strong>Trade Date (T)</strong>: The legal agreement to buy/sell is executed. The price is fixed.</li>
<li><strong>Settlement Date (T+2)</strong>: The legal ownership is transferred and cash is exchanged.</li>
</ol>
<h2 id="the-accounting-dilemma"><a class="header" href="#the-accounting-dilemma">The Accounting Dilemma</a></h2>
<p>This delay creates a gap in your records.</p>
<ul>
<li><strong>On Date T</strong>: You “own” the stock risk (if price moves, you gain/lose), but you still have the cash in your account.</li>
<li><strong>On Date T+2</strong>: The cash actually leaves.</li>
</ul>
<p>Which date should you use for your books?</p>
<h2 id="model-1-trade-date-accounting-standard"><a class="header" href="#model-1-trade-date-accounting-standard">Model 1: Trade Date Accounting (Standard)</a></h2>
<p>Beancount (and the IRS) generally favors <strong>Trade Date Accounting</strong>.</p>
<ul>
<li><strong>Concept</strong>: You record the asset change immediately on Day T.</li>
<li><strong>Reality</strong>: Your Cash account in Beancount will show a lower balance than your actual bank balance for 2 days.</li>
<li><strong>Why</strong>: Tax liability usually attaches on the Trade Date. The holding period (Long vs Short term capital gains) starts counting from the Trade Date.</li>
</ul>
<h2 id="model-2-settlement-date-accounting-cash-basis"><a class="header" href="#model-2-settlement-date-accounting-cash-basis">Model 2: Settlement Date Accounting (Cash Basis)</a></h2>
<p>Some users prefer to wait until the cash moves.</p>
<ul>
<li><strong>Concept</strong>: You ignore the trade until T+2.</li>
<li><strong>Problem</strong>: Your Portfolio Value is wrong for 2 days. You might miss tax deadlines if the trade happens on Dec 31st but settles Jan 2nd.</li>
</ul>
<h2 id="model-3-full-accrual-the-pending-asset"><a class="header" href="#model-3-full-accrual-the-pending-asset">Model 3: Full Accrual (The “Pending” Asset)</a></h2>
<p>To be perfectly accurate during the gap, you must recognize that you owe money (a Payable) or are owed money (a Receivable).</p>
<p><strong>On Trade Date:</strong>
You don’t lose Cash yet; you gain a specific liability (“Settlement Payable”).</p>
<pre><code class="language-beancount">2024-06-01 * "Buy Stock"
  Assets:Brokerage:Stock       10 AAPL {100.00 USD}
  Liabilities:Brokerage:Settlement    -1000.00 USD
</code></pre>
<p><strong>On Settlement Date:</strong>
The liability is extinguished by Cash.</p>
<pre><code class="language-beancount">2024-06-03 * "Settlement"
  Liabilities:Brokerage:Settlement     1000.00 USD
  Assets:Brokerage:Cash               -1000.00 USD
</code></pre>
<p>While Model 3 is the most “correct” for an auditor, Model 1 (Trade Date) is the standard recommendation for personal finance in Beancount because it simplifies data entry significantly.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="how-inventories-work"><a class="header" href="#how-inventories-work">How Inventories Work</a></h1>
<p>In many accounting systems, currencies are simple numbers. In Beancount, any account can hold “Inventory.”</p>
<h2 id="what-is-inventory"><a class="header" href="#what-is-inventory">What is Inventory?</a></h2>
<p>Think of an inventory as a mixed bag of items. A single account doesn’t just hold “Dollars.” It can hold:</p>
<ul>
<li>100 USD</li>
<li>50 EUR</li>
<li>10 shares of GOOG (bought at $100)</li>
<li>5 shares of GOOG (bought at $120)</li>
</ul>
<p>Beancount tracks each of these “lots” separately.</p>
<h2 id="cost-basis-the-specific-lot"><a class="header" href="#cost-basis-the-specific-lot">Cost Basis: The Specific Lot</a></h2>
<p>When you acquire a commodity (like stock), Beancount remembers the cost.</p>
<pre><code class="language-beancount">2024-01-01 * "Buy"
  Assets:Brokerage    10 GOOG {100.00 USD}
</code></pre>
<p>This creates a specific lot in your inventory: <code>10 GOOG @ 100 USD</code>.</p>
<p>If you buy more later:</p>
<pre><code class="language-beancount">2024-02-01 * "Buy More"
  Assets:Brokerage    5 GOOG {120.00 USD}
</code></pre>
<p>Your <code>Assets:Brokerage</code> account now holds two distinct lots. It does <strong>not</strong> hold “15 GOOG at average cost $106”. It holds the specific lots.</p>
<h2 id="reduction-selling"><a class="header" href="#reduction-selling">Reduction (Selling)</a></h2>
<p>When you sell, you must specify <em>which</em> lot you are reducing. Beancount needs to know this to calculate the Capital Gain correctly.</p>
<blockquote>
<p><strong>How-to:</strong> For step-by-step instructions, see <a href="#how-to-record-trades">Recording Trades</a>.</p>
</blockquote>
<pre><code class="language-beancount">2024-03-01 * "Sell"
  Assets:Brokerage    -5 GOOG {100.00 USD} @ 130.00 USD
</code></pre>
<p>Here, we explicitly told Beancount “Sell 5 shares from the lot that cost $100”.</p>
<ul>
<li>Cost: 5 * 100 = 500</li>
<li>Price: 5 * 130 = 650</li>
<li>Profit: 150</li>
</ul>
<p>If you tried to sell <code>{-5 GOOG}</code> without specifying the cost <code>{...}</code>, Beancount wouldn’t know which lot to pick and would raise an error (unless you use a booking method like FIFO, which Beancount 3 can automate in some contexts).</p>
<h2 id="strict-vs-average-booking"><a class="header" href="#strict-vs-average-booking">Strict vs Average Booking</a></h2>
<p>Beancount uses a <strong>Strict Booking</strong> model by default, often called “Specific Identification” in tax terms.</p>
<h3 id="why-strict"><a class="header" href="#why-strict">Why Strict?</a></h3>
<p>In many jurisdictions (like the US), the tax authority allows you to choose which shares you are selling.</p>
<ul>
<li><strong>Optimization</strong>: If you sell shares with a <em>high</em> cost basis, you realize a smaller capital gain (and pay less tax now).</li>
<li><strong>Control</strong>: If you want to hold onto your oldest shares (for long-term capital gains rates), you need to explicitly sell the newer ones.</li>
</ul>
<p>If Beancount automatically averaged your costs (e.g., merging the $100 and $120 lots into one $106.66 lot), you would lose this ability to optimize and report correctly.</p>
<h3 id="what-about-average-cost"><a class="header" href="#what-about-average-cost">What about Average Cost?</a></h3>
<p>Some countries (like Canada or the UK) require you to use the <strong>Average Cost Basis</strong> (ACB) method.
Beancount 3 handles this by allowing you to merge lots.</p>
<ul>
<li><strong>Manual</strong>: You can use a transaction to “convert” multiple specific lots into a single average lot, though this is tedious.</li>
<li><strong>Automatic</strong>: Beancount 3 introduces flexible booking methods that can simulate average cost behavior during reduction, or you can use plugins to enforce it.</li>
</ul>
<p>However, even with Average Cost, the underlying database in Beancount prefers strictness to ensure auditability. You can always derive an average from specific lots, but you cannot recover specific lots if you strictly averaged them on input.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rounding-and-precision"><a class="header" href="#rounding-and-precision">Rounding and Precision</a></h1>
<p>Computers often struggle with decimal numbers (e.g., <code>0.1 + 0.2</code> might equal <code>0.30000000000000004</code>). Beancount avoids this by using <strong>Decimal</strong> types, not floating-point numbers.</p>
<h2 id="precision-inference"><a class="header" href="#precision-inference">Precision Inference</a></h2>
<p>Beancount does not have a hardcoded list of currencies. Instead, it infers the precision from your file.</p>
<p>If you write:</p>
<pre><code class="language-beancount">2024-01-01 * "Test"
  Assets:Cash   10.500 USD
</code></pre>
<p>Beancount will assume USD has 3 decimal places for the entire file.
<strong>Best Practice:</strong> Always be consistent. Use <code>10.00 USD</code>, not <code>10 USD</code>.</p>
<h2 id="the-tolerance-problem"><a class="header" href="#the-tolerance-problem">The Tolerance Problem</a></h2>
<p>In real life, splitting bills or currency conversion often results in fractions of a cent.</p>
<p>Example: Splitting $10.00 three ways.</p>
<ul>
<li>Person A: 3.33</li>
<li>Person B: 3.33</li>
<li>Person C: 3.33</li>
<li>Total: 9.99</li>
</ul>
<p>The transaction is off by 0.01.</p>
<h3 id="automatic-tolerance"><a class="header" href="#automatic-tolerance">Automatic Tolerance</a></h3>
<p>Beancount allows a small tolerance (default 0.005) for transactions to balance. If the difference is within this tolerance, Beancount accepts it.</p>
<h3 id="accumulating-rounding-errors"><a class="header" href="#accumulating-rounding-errors">Accumulating Rounding Errors</a></h3>
<p>If you want to track these discrepancies explicitly (or if they are larger than the tolerance), use the <code>account_rounding</code> option.</p>
<pre><code class="language-beancount">option "account_rounding" "Equity:Rounding"
</code></pre>
<p>When this is enabled, Beancount will automatically add a posting to <code>Equity:Rounding</code> to make the transaction balance perfectly.</p>
<pre><code class="language-beancount">2024-01-01 * "Split Bill"
  Expenses:Food       10.00 USD
  Assets:A           -3.33 USD
  Assets:B           -3.33 USD
  Assets:C           -3.33 USD
  ; Implicitly adds:
  ; Equity:Rounding  -0.01 USD
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="why-beancount-3"><a class="header" href="#why-beancount-3">Why Beancount 3?</a></h1>
<p>Beancount 3 represents a significant evolution of the Beancount project.</p>
<h2 id="performance"><a class="header" href="#performance">Performance</a></h2>
<p>By moving the core logic to C++, Beancount 3 can process large ledger files (with decades of data) much faster than Beancount 2.</p>
<h2 id="type-safety-and-correctness"><a class="header" href="#type-safety-and-correctness">Type Safety and Correctness</a></h2>
<p>The rewrite allowed the authors to tighten the rules and ensure that calculations are even more precise, which is critical for financial software.</p>
<h2 id="modern-tooling"><a class="header" href="#modern-tooling">Modern Tooling</a></h2>
<p>Beancount 3 is designed to work better with modern Python environments and provides a more stable API for developers building tools on top of it.</p>
<h2 id="focus-on-the-core"><a class="header" href="#focus-on-the-core">Focus on the Core</a></h2>
<p>Beancount 3 focuses on doing the core accounting tasks perfectly. It leaves the visualization and importing to companion projects (like <a href="#using-fava-web-ui">Fava</a>), ensuring the engine remains lean and reliable.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>


        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
